<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      i18n:domain="OpenWorkouts"
      metal:use-macro="load: base.pt"
      tal:attributes="lang request.locale_name">

  <metal:head-title metal:fill-slot="head-title">
    <tal:t i18n:translate="">My dashboard</tal:t>
  </metal:head-title>

  <!--!
      <metal:title metal:fill-slot="title">
        <tal:t i18n:translate="">dashboard for user</tal:t>
        <tal:user tal:content="context.fullname"></tal:user>
      </metal:title>
      -->

  <metal:content metal:fill-slot="content">

    <div class="workout-content">

      <section class="workout-list">

        <h3>
           <tal:n tal:content="len(workouts)"></tal:n> <tal:t i18n:translate="">Activities</tal:t>
        </h3>

        <tal:no-workouts tal:condition="context.num_workouts == 0">
            <div class="warning">
                <p i18n:translate="">You haven't added any workouts yet</p>
                <p>
                    <a href="" i18n:translate=""
                       tal:attributes="href request.resource_url(context, 'add-workout')">
                        Upload one</a> |
                    <a href="" i18n:translate=""
                       tal:attributes="href request.resource_url(context, 'add-workout-manually')">
                        Add one manually</a>
                </p>
            </div>
        </tal:no-workouts>

        <tal:r tal:repeat="workout workouts">

          <article class="workout-resume">

            <h2 class="workout-title">
              <a href="" tal:content="workout.title"
                 tal:attributes="href request.resource_url(workout)"></a>
            </h2>

            <ul class="workout-info">
              <li>
                <tal:c tal:content="workout.start_in_timezone(context.timezone)"></tal:c>
              </li>
              <li>
                <!--! use the properly formatted duration instead of the timedelta object -->
                <tal:c tal:content="workout._duration"></tal:c>
              </li>
              <li tal:condition="workout.distance">
                <tal:c tal:content="workout.rounded_distance"></tal:c> km
              </li>
            </ul>

            <ul class="workout-info" tal:define="hr workout.hr; cad workout.cad">
              <li tal:condition="hr">
                <span i18n:translate="">HR (bpm)</span>:
                <tal:c tal:content="hr['min']"></tal:c>
                <tal:t i18n:translate="">Min.</tal:t>,
                <tal:c tal:content="hr['avg']"></tal:c>
                <tal:t i18n:translate="">Avg.</tal:t>,
                <tal:c tal:content="hr['max']"></tal:c>
                <tal:t i18n:translate="">Max.</tal:t>
              </li>
              <li tal:condition="cad">
                <span i18n:translate="">Cad</span>:
                <tal:c tal:content="cad['min']"></tal:c>
                <tal:t i18n:translate="">Min.</tal:t>,
                <tal:c tal:content="cad['avg']"></tal:c>
                <tal:t i18n:translate="">Avg.</tal:t>,
                <tal:c tal:content="cad['max']"></tal:c>
                <tal:t i18n:translate="">Max.</tal:t>
              </li>
            </ul>

            <div class="workout-intro" tal:content="workout.notes"></div>

            <ul class="workout-options">
              <li class="owo-edit"><a href="" i18n:translate="" tal:attributes="href request.resource_url(workout, 'edit')"><span>edit</span></a></li>
              <li class="owo-update"><a href="" i18n:translate="" tal:attributes="href request.resource_url(workout, 'update-from-file')"><span>update with tracking file</span></a></li>
              <li class="owo-del"><a href="" i18n:translate="" tal:attributes="href request.resource_url(workout, 'delete')"><span>delete</span></a></li>
            </ul>

          </article>

        </tal:r>

      </section>

      <aside class="workout-aside">
      <div class="aside-profile">
        <tal:c tal:condition="getattr(context, 'picture', None)">
          <img tal:attributes="src request.resource_path(context, 'picture')"
               width="450" />
        </tal:c>
        <h2 tal:content="context.fullname"></h2>
        <ul>
          <Li>
            <tal:n tal:content="context.num_workouts"></tal:n> <tal:t i18n:translate="">workouts</tal:t>
          </Li>
        </ul>
      </div>
          <tal:activity_tree tal:condition="context.num_workouts > 0">
              <ul class="workout-activity-tree" tal:define="tree context.activity_dates_tree">
                  <tal:years tal:repeat="year sorted(tree.keys(), reverse=True )">
                      <li tal:define="is_viewing_year year == viewing_year">
                          <a href="" tal:content="year"
                             tal:attributes="href request.resource_url(context, query={'year': year});
                                             class 'js-year viewing-year' if is_viewing_year  else 'js-year'">
                          </a>
                          <ul class="workout-activity-tree-year"
                              tal:attributes="class 'workout-activity-tree-year' if is_viewing_year  else 'workout-activity-tree-year hidden'">
                              <tal:months tal:repeat="month sorted(tree[year].keys())">
                                  <li tal:define="is_viewing_month is_viewing_year and month == viewing_month">
                                      <a href=""
                                         tal:attributes="href request.resource_url(context, query={'year': year, 'month': month});
                                                         class 'viewing-month' if is_viewing_month else ''">
                                           <span tal:content="month_name[month]"></span>
                                           <span tal:content="sum([tree[year][month][sport] for sport in tree[year][month]])"></span>
                                      </a>
                                  </li>
                              </tal:months>
                          </ul>
                      </li>
                  </tal:years>
              </ul>
          </tal:activity_tree>
      </aside>

    </div>

  </metal:content>

</html>
